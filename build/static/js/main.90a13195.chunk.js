(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{23:function(e,t,a){e.exports=a(52)},28:function(e,t,a){},30:function(e,t,a){},31:function(e,t,a){},32:function(e,t,a){},33:function(e,t,a){},51:function(e,t,a){},52:function(e,t,a){"use strict";a.r(t),a.d(t,"hostOrigin",(function(){return C}));var n=a(0),r=a.n(n),s=a(19),i=a.n(s),c=(a(28),a(4)),u=a(1),l=a.n(u),o=a(3),h=a(5),f=a(6),m=a(8),p=a(7),v=(a(30),a(21)),b=(a(31),a(32),function(e){var t=e.text,a=(e.icon,e.size),n=e.onClick;return a=a||1,r.a.createElement("div",{onClick:n,className:"scope--single-button",style:{padding:"".concat(.3*a,"rem ").concat(1.2*a,"rem")}},r.a.createElement("span",{style:{fontSize:a+"rem"}},t))}),d=function(e){var t=e.self,a=e.enemy,s=e.isMe,i=e.timer,c=e.ended,u=e.reload,l=Object(n.useState)(r.a.createElement("div",{className:"timer"})),o=Object(v.a)(l,2),h=o[0],f=o[1];return Object(n.useEffect)((function(){f(r.a.createElement("div",{className:"timer"},r.a.createElement("span",null,"\u5012\u8ba1\u65f6",r.a.createElement("b",{className:i<=5?"red":""},i))))}),[i]),r.a.createElement("div",{className:"scope--menu"},r.a.createElement("div",{className:"player player1"},r.a.createElement("b",null,t),s?h:null),r.a.createElement("div",{className:"mid"},c?r.a.createElement(b,{text:"\u9000\u51fa",onClick:u}):""),r.a.createElement("div",{className:"player player2"},r.a.createElement("b",null,a),s?null:h))},y=(a(33),a(22)),k=a(20),w=a.n(k);function E(e,t,a,n){return x.apply(this,arguments)}function x(){return(x=Object(o.a)(l.a.mark((function e(t,a,n,r){var s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w.a.post(C+"/api/gobang/"+t,a||{},Object(y.a)({withCredentials:!0},r||{}));case 3:if(s=e.sent,!(i=s.data).status){e.next=9;break}return e.abrupt("return",[!0,i.data]);case 9:return n(i.data),e.abrupt("return",[!1]);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(0),n(e.t0),e.abrupt("return",[!1]);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function S(e){var t,a=Object(c.a)(e);try{var n=function(){for(var a=t.value,n=function(){for(var t=s[r],n=[a],i=function(r){var s=e.find((function(e){return e[0]===a[0]+t[0]*r&&e[1]===a[1]+t[1]*r}));s&&n.push(s)},c=1;c<5;c++)i(c);if(5===n.length)return{v:{v:n}}},r=0,s=[[1,0],[0,1],[-1,1],[1,1],[1,-1],[-1,-1],[-1,0],[0,-1]];r<s.length;r++){var i=n();if("object"===typeof i)return i.v}};for(a.s();!(t=a.n()).done;){var r=n();if("object"===typeof r)return r.v}}catch(s){a.e(s)}finally{a.f()}return[]}var g=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var n;Object(h.a)(this,a),(n=t.call(this,e)).mouseMove=function(e){if(-1===n.props.winner&&n.props.turnOn&&!n.props.ended){var t,a=n.linesContainer.current.getBoundingClientRect(),r=a.width/14,s=Math.ceil((e.clientX-a.left-r/2)/r),i=Math.ceil((e.clientY-a.top-r/2)/r),u=Object(c.a)(n.props.history);try{for(u.s();!(t=u.n()).done;){var l=t.value;if(l[0]===s&&l[1]===i)return}}catch(f){u.e(f)}finally{u.f()}var o=[];if(n.props.assistant){var h=n.props.history.slice();h.push([s,i]),o=function(e,t,a){var n=[];return t.forEach((function(t,r){r%2===e&&Math.abs(t[0]-a[0])<5&&Math.abs(t[1]-a[1])<5&&n.push(t)})),S(n)}(n.props.myNumber,h,[s,i])}n.setState({activePos:[s,i],ceilSize:r,fakeWin:o})}else n.setState({activePos:[]})};var s=new Array(15).fill(0).map((function(e,t){return r.a.createElement("span",{key:t})}));return n.linesContainer=r.a.createRef(),n.lines=r.a.createElement("div",{className:"lines"},r.a.createElement("div",{className:"row"},s.slice()),r.a.createElement("div",{className:"column"},s.slice())),n.state={ceilSize:0,activePos:[],tri:[],quart:[],fakeWin:[]},n}return Object(f.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.ceilSize,n=t.activePos,s=4*a/5;return r.a.createElement("div",{className:"scope--board",onMouseMove:function(t){e.mouseMove(t)},onClick:function(){return e.props.play(n)}},r.a.createElement("div",{ref:this.linesContainer,className:"board"},this.lines),r.a.createElement("div",{className:"chess-container"},n.length?r.a.createElement("span",{className:"active chess "+(this.state.fakeWin.find((function(e){return e[0]===n[0]&&e[1]===n[1]}))?"fake-win":""),style:this.genChessStyle({pos:n,chessSize:s,ceilSize:a})}):"",this.props.history.map((function(t,n){return r.a.createElement("span",{key:n,className:"chess "+(n%2?"white ":"black ")+(e.state.fakeWin.find((function(e){return e[0]===t[0]&&e[1]===t[1]}))?"fake-win ":" ")+(n%2===e.props.winner&&e.props.winList.find((function(e){return e[0]===t[0]&&e[1]===t[1]}))?"win":""),style:e.genChessStyle({pos:t,chessSize:s,ceilSize:a})})}))))}},{key:"genChessStyle",value:function(e){var t=e.pos,a=e.chessSize,n=e.ceilSize;return{width:a+"px",height:a+"px",left:Math.floor(n*t[0]+a/5-n/2-2)+"px",top:Math.floor(n*t[1]+a/5-n/2-2)+"px"}}}]),a}(r.a.Component),N={nickName:{zh:"\u6635\u79f0",en:"nick name"},createGame:{zh:"\u521b\u5efa",en:"create new"},joinGame:{zh:"\u52a0\u5165",en:"join"},watchGame:{zh:"\u89c2\u6218",en:"watch"},cancel:{zh:"\u53d6\u6d88",en:"cancel"}},j=(a(51),function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).addText=function(e,t){var a=n.state.lis.slice(0,4);a.splice(0,0,{id:n.id++,text:e,class_:t||"err"}),n.id=n.id%5,n.setState({lis:a}),n.animateEndLength=0},n.id=0,n.animateEndLength=0,n.state={lis:[]},e.set(n.addText),n}return Object(f.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("section",{className:"scope--status-bar"},this.state.lis.map((function(t){return r.a.createElement("span",{className:t.class_,key:t.id,onAnimationEnd:function(){e.animateEndLength++,e.state.lis.length===e.animateEndLength&&e.setState({lis:[]})}},t.text)})))}}]),a}(r.a.Component)),O=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).activePos=[],n.statusBar=r.a.createElement(j,{set:function(e){n.setState({setStatus:e})}}),n.state={available:"",setStatus:null,lang:"zh",assistant:!0,self:"",enemy:"unknown",myNumber:0,turnAt:0,timer:17,history:[],endState:!1,winner:-1,winList:[]},n}return Object(f.a)(a,[{key:"componentDidMount",value:function(){var e=this;Object(o.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reload();case 2:case"end":return t.stop()}}),t)})))()}},{key:"throwError",value:function(e,t){this.state.setStatus(e,t)}},{key:"reload",value:function(){var e=Object(o.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({available:"",enemy:"unknown",myNumber:0,turnAt:0,timer:0,history:[],endState:!1,winner:-1,winList:[]}),e.next=3,this.getAvailable();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAvailable",value:function(){var e=Object(o.a)(l.a.mark((function e(){var t,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E("check-available",{},(function(e){return a.throwError(e)}));case 2:(t=e.sent)[0]?typeof t[1]===typeof[]?(this.setState({enemy:t[1][1]}),this.setState({available:t[1][0]})):this.setState({available:t[1]}):this.setState({available:"resume"});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createGame",value:function(){var e=Object(o.a)(l.a.mark((function e(){var t,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.self){e.next=3;break}return this.throwError("\u6635\u79f0\u4e0d\u80fd\u4e3a\u7a7a!"),e.abrupt("return");case 3:return e.next=5,E("create",{nick:this.state.self},(function(e){return a.throwError(e)}));case 5:if(!e.sent[0]){e.next=21;break}return this.setState({available:"waiting"}),e.next=10,E("wait",{},(function(e){return a.throwError(e)}));case 10:if(!(t=e.sent)[0]){e.next=17;break}return this.setState({enemy:t[1],myNumber:0,available:"running"}),e.next=15,this.gameLoop();case 15:e.next=19;break;case 17:return e.next=19,this.reload();case 19:e.next=23;break;case 21:return e.next=23,this.reload();case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancelWait",value:function(){var e=Object(o.a)(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E("end",{},(function(e){return t.throwError(e)}));case 2:if(!e.sent[0]){e.next=6;break}return e.next=6,this.reload();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"joinGame",value:function(){var e=Object(o.a)(l.a.mark((function e(){var t,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.self){e.next=3;break}return this.throwError("\u6635\u79f0\u4e0d\u80fd\u4e3a\u7a7a!"),e.abrupt("return");case 3:return e.next=5,E("join",{nick:this.state.self},(function(e){return a.throwError(e)}));case 5:if(!(t=e.sent)[0]){e.next=12;break}return this.setState({enemy:t[1],myNumber:1,available:"running"}),e.next=10,this.gameLoop();case 10:e.next=14;break;case 12:return e.next=14,this.reload();case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"gameLoop",value:function(){var e=Object(o.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.turnAt===this.state.myNumber){e.next=6;break}return e.next=3,this.gameWait();case 3:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:this.setState({turnAt:this.state.turnAt?0:1});case 6:return e.next=8,this.gamePlay();case 8:if(!e.sent){e.next=18;break}return this.setState({turnAt:this.state.turnAt?0:1}),e.next=12,this.gameWait();case 12:if(t=e.sent,this.setState({turnAt:this.state.turnAt?0:1}),t){e.next=16;break}return e.abrupt("return");case 16:e.next=6;break;case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"gamePlay",value:function(){var e=Object(o.a)(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("wait play"),e.abrupt("return",new Promise((function(e){t.setState({timer:17});var a=setInterval((function(){t.setState({timer:t.state.timer-1}),0===t.state.timer&&(window.removeEventListener("play-event",n),clearInterval(a),t.throwError("\u8d85\u65f6\uff0c\u4f60\u8f93\u4e86"),t.setState({endState:!0}))}),1e3),n=function(){var r=Object(o.a)(l.a.mark((function r(s){return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(window.removeEventListener("play-event",n),clearInterval(a),!t.checkWin(t.state.myNumber,s.detail)&&!t.checkDraw(s.detail)){r.next=8;break}return r.next=5,E("play",{pos:JSON.stringify(t.activePos),end:!0},(function(e){return t.throwError(e)}));case 5:e(!1),r.next=13;break;case 8:return r.t0=e,r.next=11,E("play",{pos:JSON.stringify(t.activePos)},(function(e){return t.throwError(e)}));case 11:r.t1=r.sent[0],(0,r.t0)(r.t1);case 13:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}();window.addEventListener("play-event",n)})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setCheese",value:function(e){if(-1!==this.state.winner||0===e.length||this.state.endState)return!1;if(this.state.turnAt===this.state.myNumber){this.activePos=e;var t=this.state.history.slice();t.push(e),this.setState({history:t});var a=new CustomEvent("play-event",{detail:t});window.dispatchEvent(a)}else this.throwError("\u8bf7\u5148\u7b49\u5f85\u5bf9\u65b9\u4e0b\u68cb")}},{key:"gameWait",value:function(){var e=Object(o.a)(l.a.mark((function e(){var t,a,n,r,s,i,u,o=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===this.state.winner){e.next=2;break}return e.abrupt("return",!1);case 2:return console.log("wait enemy play"),this.setState({timer:17}),t=setInterval((function(){o.setState({timer:o.state.timer-1}),0===o.state.timer&&clearInterval(t)}),1e3),e.next=7,E("wait",{},(function(e){return o.throwError(e)}),{timeout:18e3});case 7:if(a=e.sent,clearInterval(t),!a[0]){e.next=41;break}if("end"!==a[1]){e.next=16;break}return this.throwError("\u5bf9\u65b9\u5f03\u6218\u4e86","warn"),this.setState({endState:!0}),e.abrupt("return",!1);case 16:n=JSON.parse(a[1]),r=Object(c.a)(this.state.history),e.prev=18,r.s();case 20:if((s=r.n()).done){e.next=28;break}if((i=s.value)[0]!==n[0]||i[1]!==n[1]){e.next=26;break}return this.throwError("\u5bf9\u65b9\u975e\u6cd5\u64cd\u4f5c!","warn"),this.setState({endState:!0}),e.abrupt("return",!1);case 26:e.next=20;break;case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(18),r.e(e.t0);case 33:return e.prev=33,r.f(),e.finish(33);case 36:if((u=this.state.history.slice()).push(n),this.setState({history:u}),!this.checkWin(this.state.myNumber?0:1,u)&&!this.checkDraw(u)){e.next=41;break}return e.abrupt("return",!1);case 41:return e.abrupt("return",a[0]);case 42:case"end":return e.stop()}}),e,this,[[18,30,33,36]])})));return function(){return e.apply(this,arguments)}}()},{key:"watchGame",value:function(){}},{key:"render",value:function(){var e=this,t="";switch(this.state.available){case"":t=r.a.createElement("div",{className:this.state.available},"\u521d\u59cb\u5316...");break;case"not":t=r.a.createElement("div",{className:this.state.available},"\u51fa\u9519\u4e86,\u5c1d\u8bd5\u5237\u65b0\u9875\u9762?");break;case"exist":t=r.a.createElement("div",{className:this.state.available},"\u6709\u4eba\u5728\u73a9\u4e86,\u4f60\u53ef\u4ee5\u9009\u62e9\u89c2\u6218",r.a.createElement(b,{text:N.watchGame[this.state.lang],onClick:function(){return e.watchGame()}}));break;case"create":t=r.a.createElement("div",{className:this.state.available},r.a.createElement("label",null,r.a.createElement("input",{placeholder:N.nickName[this.state.lang],value:this.state.self,onChange:function(t){e.setState({self:t.target.value})}})),r.a.createElement(b,{text:N.createGame[this.state.lang],onClick:function(){return e.createGame()}}));break;case"waiting":t=r.a.createElement("div",{className:this.state.available},r.a.createElement("span",null,"\u7b49\u5f85\u73a9\u5bb6\u52a0\u5165..."),r.a.createElement(b,{text:N.cancel[this.state.lang],onClick:function(){return e.cancelWait()}}));break;case"join":t=r.a.createElement("div",{className:this.state.available},r.a.createElement("p",null,"\u52a0\u5165",r.a.createElement("b",null,this.state.enemy),"\u7684\u5bf9\u5c40"),r.a.createElement("label",null,r.a.createElement("input",{placeholder:N.nickName[this.state.lang],value:this.state.self,onChange:function(t){e.setState({self:t.target.value})}})),r.a.createElement(b,{text:N.joinGame[this.state.lang],onClick:function(){return e.joinGame()}}));break;case"running":t=r.a.createElement("div",{className:this.state.available},r.a.createElement(d,{self:this.state.self,enemy:this.state.enemy,isMe:this.state.myNumber===this.state.turnAt,timer:this.state.timer,ended:this.state.endState,reload:function(){e.reload().then()}}),r.a.createElement(g,{history:this.state.history,ended:this.state.endState,myNumber:this.state.myNumber,play:function(t){e.setCheese(t)},assistant:this.state.assistant,turnOn:this.state.myNumber===this.state.turnAt,winner:this.state.winner,winList:this.state.winList}));break;case"resume":t=r.a.createElement("div",{className:this.state.available},"\u6b63\u5728\u6062\u590d\u5bf9\u5c40...")}return r.a.createElement("div",{className:"scope--game"},this.statusBar,t)}},{key:"checkWin",value:function(e,t){var a=function(e,t){var a=[];return t.forEach((function(t,n){n%2===e&&a.push(t)})),S(a)}(e,t),n=a.length?e:-1;this.setState({winner:n,winList:a,endState:-1!==n});var r=n===this.state.myNumber;return n>-1&&this.throwError("\u4f60"+(r?"\u8d62":"\u8f93")+"\u4e86",r?"succ":"err"),a.length}},{key:"checkDraw",value:function(e){return 225===e.length&&(this.throwError("\u5e73\u5c40","succ"),this.setState({endState:!0}),!0)}}]),a}(r.a.Component),C="https://fun-backend.herokuapp.com";i.a.render(r.a.createElement(O,null),document.getElementById("root"))}},[[23,1,2]]]);
//# sourceMappingURL=main.90a13195.chunk.js.map